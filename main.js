(()=>{"use strict";new class{constructor(t){this.productsArr=[],t&&(this.productsArr=t)}init(){this.form=document.forms.addUpdateProduct,this.formInputs=document.querySelectorAll("input"),this.deleteConfirm=document.querySelector(".delete"),this.modal=document.querySelector(".modal"),this.productCancelBtn=document.querySelector(".product-form__buttons_reset"),this.products=document.querySelector(".products"),this.productsDeleteItem=document.querySelector(".delete-product"),this.producstList=document.querySelector(".products-list__items"),this.productsAddButton=document.querySelector(".products-header__add"),this.editProductId=null,this.editProductArrIndex=null;const t=this.productsArr.slice();this.lastProductId=t.sort(((t,e)=>t.id-e.id)).at(-1).id,this.events(),this.updateList()}events(){this.form.addEventListener("submit",(t=>this.productSave(t))),this.productCancelBtn.addEventListener("click",(t=>this.productCancel(t))),this.products.addEventListener("click",(t=>this.eventsButtons(t))),Array.from(this.formInputs).forEach((t=>{t.addEventListener("focus",(()=>{this.validateClear()})),t.addEventListener("blur",(()=>{this.validate(t)}))}))}eventsDisable(){this.eventButtons=document.querySelectorAll(".event-button"),Array.from(this.eventButtons).forEach((t=>{t.classList.add("btn-disable")}))}eventsButtons(t){this.modal.classList.contains("show")||(t.target.classList.contains("add-btn")&&this.showModal(this.form),t.target.classList.contains("edit-btn")&&this.productEdit(t.target),t.target.classList.contains("delete-btn")&&this.productDelete(t.target))}eventsEnable(){this.eventButtons=document.querySelectorAll(".event-button"),Array.from(this.eventButtons).forEach((t=>{t.classList.remove("btn-disable")}))}productCancel(t){t.preventDefault(),this.form.reset(),this.form.classList.remove("show"),this.modal.classList.remove("show"),this.validateClear(),this.eventsEnable(),this.editProductId=null,this.editProductArrIndex=null}productEdit(t){this.editProductId=+t.closest("div.products-list__item").dataset.id,this.editProductArrIndex=this.productsArr.findIndex((t=>t.id===this.editProductId)),this.showModal(this.form),this.form.elements.name.value=this.productsArr[this.editProductArrIndex].name,this.form.elements.price.value=this.productsArr[this.editProductArrIndex].price}productDelete(t){const e=+t.closest("div.products-list__item").dataset.id,s=this.productsArr.findIndex((t=>t.id===e));this.showModal(this.deleteConfirm),this.productsDeleteItem.innerHTML=this.productsArr[s].name,document.querySelector(".delete-buttons").addEventListener("click",(t=>{if(t.target.classList.contains("delete-buttons_save"))return this.productsArr.splice(s,1),this.updateList(),void this.productDeleteCloseModal();t.target.classList.contains("delete-buttons_reset")&&this.productDeleteCloseModal()}),{once:!0})}productDeleteCloseModal(){this.deleteConfirm.classList.remove("show"),this.modal.classList.remove("show"),this.eventsEnable()}productSave(t){if(t.preventDefault(),!t.currentTarget.checkValidity()){const t=[...this.form.elements].find((t=>!t.validity.valid));return void this.validate(t)}const e={id:+(this.lastProductId+1),name:this.form.elements.name.value,price:+this.form.elements.price.value};this.editProductId?(e.id=this.editProductId,this.productsArr.splice(this.editProductArrIndex,1,e),this.editProductId=null,this.editProductArrIndex=null):(this.productsArr.push(e),this.lastProductId+=1),this.form.reset(),this.form.classList.remove("show"),this.modal.classList.remove("show"),this.updateList(),this.eventsEnable()}showModal(t){this.validateClear(),t.classList.add("show"),this.modal.classList.add("show"),this.modal.style.left=this.products.getBoundingClientRect().width/2-this.modal.getBoundingClientRect().width/2+"px",this.eventsDisable()}validate(t){if(!t.validity.valid)switch(t.name){case"product_name":this.showError("Введите название товара",t);break;case"product_price":this.showError("Введите цену товара (больше 0)",t)}}validateClear(){const t=document.querySelectorAll(".popover");t.length>0&&Array.from(t).forEach((t=>{t.classList.remove("popover-visible"),setTimeout((()=>t.remove()),500)}))}showError(t,e){const s=document.createElement("div");s.className="popover";const i=document.createElement("div");i.className="arrow";const r=document.createElement("div");r.className="popover-body",r.textContent=t,s.append(i),s.append(r),e.after(s),i.style.left=s.getBoundingClientRect().width/2-i.getBoundingClientRect().width+3+"px",s.style.top=e.closest(".product-form__field").getBoundingClientRect().height-2+"px",s.classList.add("popover-visible")}updateList(){this.producstList.innerHTML="",this.productsArr.forEach((t=>{const e=document.createElement("div");e.className="products-list__item",e.dataset.id=t.id,e.innerHTML=`\n                <div class="products-name">${t.name}</div>\n                <div class="products-price">${t.price}</div>\n                <div class="products-actions">\n                    <span class="products-actions__item edit-btn event-button">✎</span>\n                    <span class="products-actions__item delete-btn event-button">✕</span>\n                </div>            \n            `,this.producstList.append(e)}))}}([{id:30,name:"iPhone XR",price:6e4},{id:2,name:"Samsunh Galaxy S10+",price:8e4},{id:1,name:"Huawei View",price:5e4}]).init()})();